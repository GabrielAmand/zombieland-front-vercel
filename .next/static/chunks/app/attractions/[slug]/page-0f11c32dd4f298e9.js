(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[209],{2383:(e,t,r)=>{"use strict";r.d(t,{e:()=>a});var n=r(9509);function a(){if(!n.env.NEXT_PUBLIC_API_URL)throw Error("NEXT_PUBLIC_API_URL n'est pas d\xe9finie.");return n.env.NEXT_PUBLIC_API_URL}},3997:(e,t,r)=>{"use strict";r.d(t,{default:()=>l});var n=r(5155),a=r(6766),s=r(6874),i=r.n(s);function l(e){let{attraction:t}=e;return(0,n.jsxs)("div",{className:"max-w-3xl mx-auto px-4 py-10 space-y-8",children:[(0,n.jsx)(i(),{href:"/attractions",className:"text-primary hover:underline",children:"← Retour aux attractions"}),(0,n.jsx)("div",{className:"relative w-full h-64 md:h-96 rounded-lg overflow-hidden border-2 border-primary",children:(0,n.jsx)(a.default,{src:"/images/desktop/".concat(t.id,".webp"),alt:t.name,fill:!0,className:"object-cover"})}),(0,n.jsx)("h1",{className:"text-3xl md:text-4xl font-subtitle text-primary-light",children:t.name}),(0,n.jsx)("article",{className:"prose prose-invert max-w-none",children:(0,n.jsx)("p",{children:t.description})})]})}},4831:(e,t,r)=>{"use strict";r.d(t,{W:()=>c,x:()=>o});var n=r(5155),a=r(7383),s=r(2115),i=r(9509);let l=(0,s.createContext)({token:null,setToken:()=>{},user:null,loading:!0}),o=e=>{let{children:t}=e,[r,o]=(0,s.useState)(()=>a.A.get("zombieland_token")||null),[c,u]=(0,s.useState)(null),[d,m]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{(async()=>{if(!r){u(null),m(!1);return}try{let e=await fetch("".concat(i.env.NEXT_PUBLIC_API_URL,"/auth/verify"),{headers:{Authorization:"Bearer ".concat(r)},credentials:"include"});if(e.ok){let t=await e.json();u(t.user)}else a.A.remove("zombieland_token"),o(null),u(null)}catch(e){console.error("Erreur lors du check token :",e),a.A.remove("zombieland_token"),o(null),u(null)}finally{m(!1)}})()},[r]),(0,n.jsx)(l.Provider,{value:{token:r,setToken:e=>{e?(a.A.set("zombieland_token",e,{expires:1,secure:!0,sameSite:"strict"}),o(e)):(a.A.remove("zombieland_token"),o(null),u(null))},user:c,loading:d},children:t})},c=()=>(0,s.useContext)(l)},4837:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(5155);function a(e){let{isOpen:t,onClose:r,title:a,children:s,confirmText:i="Confirmer",onConfirm:l,disableConfirm:o=!1,loading:c=!1}=e;return t?(0,n.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur z-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"bg-bg rounded-lg p-6 w-full max-w-md shadow-lg",children:[(0,n.jsx)("h3",{className:"text-xl font-bold mb-4 text-primary font-subtitle uppercase",children:a}),(0,n.jsx)("div",{className:"text-text font-body mb-4",children:s}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)("button",{type:"button",onClick:r,className:"px-3 py-1 rounded bg-muted text-bg hover:bg-muted/80 transition font-subtitle uppercase",children:"Annuler"}),l&&(0,n.jsx)("button",{type:"button",onClick:l,disabled:o||c,className:"px-3 py-1 rounded font-subtitle uppercase transition ".concat(i.toLowerCase().includes("supprim")||i.toLowerCase().includes("annul")?"bg-red-600 hover:bg-red-700":"bg-primary text-black hover:bg-primary-dark"," disabled:opacity-50"),children:c?"Envoi…":i})]})]})}):null}},5695:(e,t,r)=>{"use strict";var n=r(8999);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},7383:(e,t,r)=>{"use strict";function n(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}r.d(t,{A:()=>a});var a=function e(t,r){function a(e,a,s){if("undefined"!=typeof document){"number"==typeof(s=n({},r,s)).expires&&(s.expires=new Date(Date.now()+864e5*s.expires)),s.expires&&(s.expires=s.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var l in s)s[l]&&(i+="; "+l,!0!==s[l]&&(i+="="+s[l].split(";")[0]));return document.cookie=e+"="+t.write(a,e)+i}}return Object.create({set:a,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],n={},a=0;a<r.length;a++){var s=r[a].split("="),i=s.slice(1).join("=");try{var l=decodeURIComponent(s[0]);if(n[l]=t.read(i,l),e===l)break}catch(e){}}return e?n[e]:n}},remove:function(e,t){a(e,"",n({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,n({},this.attributes,t))},withConverter:function(t){return e(n({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})},7777:(e,t,r)=>{Promise.resolve().then(r.bind(r,3997)),Promise.resolve().then(r.bind(r,7969))},7969:(e,t,r)=>{"use strict";r.d(t,{default:()=>m});var n=r(5155),a=r(5005),s=r(2115),i=r(2383);function l(e){let{review:t}=e;return(0,n.jsx)("article",{className:"min-w-full md:min-w-[50%] lg:min-w-[33.333%] flex-shrink-0 p-4",children:(0,n.jsxs)("div",{className:"h-full border-2 border-primary rounded-lg p-4 bg-bg shadow",children:[(0,n.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,n.jsx)("span",{className:"text-primary",children:"⭐".repeat(t.rating)})}),(0,n.jsx)("p",{className:"italic",children:t.comment})]})})}var o=r(5695),c=r(4837),u=r(4831);function d(e){let{attractionId:t,onClose:r,onSubmit:a,initialComment:l,initialRating:d}=e,{token:m}=(0,u.W)(),[p,x]=(0,s.useState)(l||""),[f,h]=(0,s.useState)(d||5),[b,v]=(0,s.useState)(!1),[g,j]=(0,s.useState)(null),y=(0,o.usePathname)(),w=(0,o.useRouter)(),N=async()=>{if(!m){localStorage.setItem("pendingReview",JSON.stringify({comment:p,rating:f,attractionId:t})),j("Vous devez \xeatre connect\xe9 pour laisser un avis."),w.push("/connexion?redirect=".concat(y));return}v(!0),j(null);try{let e=await fetch("".concat((0,i.e)(),"/reviews/").concat(t),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(m)},body:JSON.stringify({comment:p,rating:f})});if(!e.ok){let{error:t}=await e.json();throw Error(null!=t?t:"\xc9chec de l’envoi")}let{review:r}=await e.json();a(r)}catch(e){j(e.message)}finally{v(!1)}};return(0,n.jsxs)(c.A,{isOpen:!0,onClose:r,onConfirm:N,confirmText:"Envoyer",loading:b,title:"Laisser un avis",disableConfirm:""===p.trim(),children:[g&&(0,n.jsx)("p",{className:"text-red-600 mb-2",children:g}),(0,n.jsx)("textarea",{className:"w-full mb-2 p-2 border rounded bg-bg text-text",placeholder:"Votre commentaire",value:p,onChange:e=>x(e.target.value)}),(0,n.jsx)("select",{className:"w-full mb-4 p-2 border rounded bg-bg text-text",value:f,onChange:e=>h(Number(e.target.value)),children:[1,2,3,4,5].map(e=>(0,n.jsxs)("option",{value:e,className:"bg-bg",children:[e," ⭐"]},e))})]})}function m(e){let{attractionId:t}=e,[r,o]=(0,a.A)({loop:!0}),[c,u]=(0,s.useState)([]),[m,p]=(0,s.useState)(0),[x,f]=(0,s.useState)(!1),[h,b]=(0,s.useState)(""),[v,g]=(0,s.useState)(5);(0,s.useEffect)(()=>{!async function(){try{let e=await fetch("".concat((0,i.e)(),"/reviews/").concat(t)),r=await e.json();u(r.reviews)}catch(e){console.error("Erreur fetch reviews :",e)}}()},[t]),(0,s.useEffect)(()=>{let e=localStorage.getItem("pendingReview");if(e){try{let r=JSON.parse(e);(null==r?void 0:r.attractionId)===t&&(b(r.comment||""),g(r.rating||5),f(!0))}catch(e){console.error("Erreur parsing pendingReview :",e)}localStorage.removeItem("pendingReview")}},[t]);let j=(0,s.useCallback)(()=>{o&&p(o.selectedScrollSnap())},[o]);return(0,s.useEffect)(()=>{if(o)return o.on("select",j),()=>{o.off("select",j)}},[o,j]),(0,n.jsxs)("div",{className:"mb-16",children:[(0,n.jsx)("div",{className:"max-w-3xl mx-auto px-4 py-10 space-y-8",children:c.length>0?(0,n.jsx)("h2",{className:"text-primary-light font-subtitle uppercase tracking-wide text-2xl",children:"Avis des visiteurs"}):(0,n.jsx)("h2",{className:"text-primary-light font-subtitle uppercase tracking-wide text-2xl",children:"Acun avis pour le moment"})}),(0,n.jsx)("div",{ref:r,className:"max-w-3xl  w-full mx-auto",children:(0,n.jsx)("div",{className:"flex gap-4 mx-auto ",children:c.map(e=>(0,n.jsx)(l,{review:e},e.id))})}),(0,n.jsx)("ul",{className:"mt-4 flex justify-center gap-2",children:c.map((e,t)=>(0,n.jsx)("li",{children:(0,n.jsx)("button",{type:"button",onClick:()=>null==o?void 0:o.scrollTo(t),className:"size-3 rounded-full transition ".concat(m===t?"bg-primary":"bg-muted")})},t))}),(0,n.jsx)("div",{className:"text-center mt-6",children:(0,n.jsx)("button",{type:"button",onClick:()=>f(!0),className:"inline-block rounded-lg bg-primary px-6 py-2 font-bold text-bg transition hover:bg-primary-dark ",children:"Ajouter un avis"})}),x&&(0,n.jsx)(d,{attractionId:t,onClose:()=>f(!1),onSubmit:e=>{u(t=>[e,...t]),f(!1),null==o||o.scrollTo(0)},initialComment:h,initialRating:v})]})}}},e=>{e.O(0,[874,766,5,441,964,358],()=>e(e.s=7777)),_N_E=e.O()}]);