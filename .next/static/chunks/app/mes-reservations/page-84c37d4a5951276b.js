(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[782],{2383:(e,t,r)=>{"use strict";r.d(t,{e:()=>o});var n=r(9509);function o(){if(!n.env.NEXT_PUBLIC_API_URL)throw Error("NEXT_PUBLIC_API_URL n'est pas d\xe9finie.");return n.env.NEXT_PUBLIC_API_URL}},4831:(e,t,r)=>{"use strict";r.d(t,{W:()=>c,x:()=>l});var n=r(5155),o=r(7383),i=r(2115),s=r(9509);let a=(0,i.createContext)({token:null,setToken:()=>{},user:null,loading:!0}),l=e=>{let{children:t}=e,[r,l]=(0,i.useState)(()=>o.A.get("zombieland_token")||null),[c,u]=(0,i.useState)(null),[d,m]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{(async()=>{if(!r){u(null),m(!1);return}try{let e=await fetch("".concat(s.env.NEXT_PUBLIC_API_URL,"/auth/verify"),{headers:{Authorization:"Bearer ".concat(r)},credentials:"include"});if(e.ok){let t=await e.json();u(t.user)}else o.A.remove("zombieland_token"),l(null),u(null)}catch(e){console.error("Erreur lors du check token :",e),o.A.remove("zombieland_token"),l(null),u(null)}finally{m(!1)}})()},[r]),(0,n.jsx)(a.Provider,{value:{token:r,setToken:e=>{e?(o.A.set("zombieland_token",e,{expires:1,secure:!0,sameSite:"strict"}),l(e)):(o.A.remove("zombieland_token"),l(null),u(null))},user:c,loading:d},children:t})},c=()=>(0,i.useContext)(a)},4837:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(5155);function o(e){let{isOpen:t,onClose:r,title:o,children:i,confirmText:s="Confirmer",onConfirm:a,disableConfirm:l=!1,loading:c=!1}=e;return t?(0,n.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur z-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"bg-bg rounded-lg p-6 w-full max-w-md shadow-lg",children:[(0,n.jsx)("h3",{className:"text-xl font-bold mb-4 text-primary font-subtitle uppercase",children:o}),(0,n.jsx)("div",{className:"text-text font-body mb-4",children:i}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)("button",{type:"button",onClick:r,className:"px-3 py-1 rounded bg-muted text-bg hover:bg-muted/80 transition font-subtitle uppercase",children:"Annuler"}),a&&(0,n.jsx)("button",{type:"button",onClick:a,disabled:l||c,className:"px-3 py-1 rounded font-subtitle uppercase transition ".concat(s.toLowerCase().includes("supprim")||s.toLowerCase().includes("annul")?"bg-red-600 hover:bg-red-700":"bg-primary text-black hover:bg-primary-dark"," disabled:opacity-50"),children:c?"Envoi…":s})]})]})}):null}},5695:(e,t,r)=>{"use strict";var n=r(8999);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},6219:(e,t,r)=>{Promise.resolve().then(r.bind(r,7900))},7383:(e,t,r)=>{"use strict";function n(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}r.d(t,{A:()=>o});var o=function e(t,r){function o(e,o,i){if("undefined"!=typeof document){"number"==typeof(i=n({},r,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var a in i)i[a]&&(s+="; "+a,!0!==i[a]&&(s+="="+i[a].split(";")[0]));return document.cookie=e+"="+t.write(o,e)+s}}return Object.create({set:o,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],n={},o=0;o<r.length;o++){var i=r[o].split("="),s=i.slice(1).join("=");try{var a=decodeURIComponent(i[0]);if(n[a]=t.read(s,a),e===a)break}catch(e){}}return e?n[e]:n}},remove:function(e,t){o(e,"",n({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,n({},this.attributes,t))},withConverter:function(t){return e(n({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})},7900:(e,t,r)=>{"use strict";r.d(t,{default:()=>c});var n=r(5155),o=r(5695),i=r(2115),s=r(4837),a=r(4831),l=r(2383);function c(){let{token:e,user:t,loading:r}=(0,a.W)(),[c,u]=(0,i.useState)([]),[d,m]=(0,i.useState)(!0),[p,f]=(0,i.useState)(!1),x=(0,o.useRouter)(),h=(0,o.useSearchParams)(),[v,b]=(0,i.useState)(!1),[g,y]=(0,i.useState)(!1),[C,j]=(0,i.useState)(null),[w,k]=(0,i.useState)(""),[N,_]=(0,i.useState)(!1),[E,S]=(0,i.useState)(!1),T=async()=>{if(!C)return;let t=new Date;if((new Date(C.visit_date).getTime()-t.getTime())/864e5<=10)return void console.warn("Suppression interdite \xe0 moins de 10 jours.");_(!0);try{(await fetch("".concat((0,l.e)(),"/myReservations/").concat(C.id),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},credentials:"include"})).ok?(u(e=>e.filter(e=>e.id!==C.id)),b(!1),j(null)):console.error("Erreur lors de la suppression.")}catch(e){console.error("Erreur lors de la suppression :",e)}finally{_(!1)}},A=async()=>{if(!C||!w)return;let t=new Date,r=new Date(w);if((r.getTime()-t.getTime())/864e5<=10)return void console.warn("Modification interdite \xe0 moins de 10 jours.");S(!0);try{let t=r.toISOString();(await fetch("".concat((0,l.e)(),"/myReservations/").concat(C.id),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({visit_date:t})})).ok?(u(e=>e.map(e=>e.id===C.id?{...e,visit_date:t}:e)),y(!1),j(null),k("")):console.error("Erreur lors de la modification.")}catch(e){console.error("Erreur lors de la modification :",e)}finally{S(!1)}};return((0,i.useEffect)(()=>{if(!r&&(!e||!t||!t.id)){f(!0);let e=setTimeout(()=>{let e=h.get("redirect")||"/mes-reservations";x.push("/connexion?redirect=".concat(e))},3e3);return()=>clearTimeout(e)}},[r,e,t,x,h]),(0,i.useEffect)(()=>{let r=async()=>{try{let t=await fetch("".concat((0,l.e)(),"/myReservations/userId"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},credentials:"include"});if(!t.ok)return void console.error("Erreur lors de la r\xe9cup\xe9ration des r\xe9servations");let r=await t.json();u(r.userReservations||[])}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration des r\xe9servations",e)}finally{m(!1)}};e&&t&&t.id?r():m(!1)},[e,t]),p)?(0,n.jsxs)("p",{className:"text-center text-primary mt-6",children:["Vous devez \xeatre connect\xe9 pour avoir acc\xe8s \xe0 vos r\xe9servations,",(0,n.jsx)("br",{}),"vous allez \xeatre redirig\xe9 vers la connexion..."]}):r||d?(0,n.jsx)("p",{className:"text-center text-primary mt-6",children:"Chargement des r\xe9servations..."}):0===c.length?(0,n.jsx)("p",{className:"text-center text-muted mt-6",children:"Vous n'avez pas encore de r\xe9servations."}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"flex flex-col gap-4 mt-6",children:c.map(e=>{let t=new Date,r=new Date(e.visit_date),o=r.getTime()-t.getTime();return(0,n.jsxs)("div",{className:"bg-surface rounded-lg p-4 shadow-md flex flex-col gap-2",children:[(0,n.jsxs)("h2",{className:"text-primary-light font-subtitle text-xl",children:["R\xe9servation du ",r.toLocaleDateString()]}),(0,n.jsxs)("p",{className:"text-text font-body",children:["Nombre de participants : ",e.nb_participants]}),(0,n.jsxs)("p",{className:"text-text font-body",children:["Montant pay\xe9 : ",Number(e.amount).toFixed(2)," €"]}),o/864e5>10&&(0,n.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,n.jsx)("button",{type:"button",className:"bg-primary text-bg rounded px-4 py-2 font-subtitle uppercase w-1/2",onClick:()=>{j(e),k(e.visit_date.slice(0,10)),y(!0)},children:"Modifier"}),(0,n.jsx)("button",{type:"button",className:"bg-red-600 text-bg rounded px-4 py-2 font-subtitle uppercase w-1/2",onClick:()=>{j(e),b(!0)},children:"Annuler"})]})]},e.id)})}),(0,n.jsx)(s.A,{isOpen:v,onClose:()=>{b(!1),j(null)},title:"Confirmer l'annulation",confirmText:"Confirmer l'annulation",onConfirm:T,loading:N,children:(0,n.jsx)("p",{className:"text-text font-body",children:"\xcates-vous certain de vouloir annuler ? Un remboursement vous sera effectu\xe9."})}),(0,n.jsx)(s.A,{isOpen:g,onClose:()=>{y(!1),j(null),k("")},title:"Modifier la r\xe9servation",confirmText:"Confirmer",onConfirm:A,disableConfirm:!w,loading:E,children:(0,n.jsx)("input",{type:"date",value:w,onChange:e=>k(e.target.value),min:function(){let e=new Date;return e.setDate(e.getDate()+10),e.toISOString().split("T")[0]}(),className:"w-full mb-4 p-2 border rounded bg-bg text-text"})})]})}}},e=>{e.O(0,[441,964,358],()=>e(e.s=6219)),_N_E=e.O()}]);