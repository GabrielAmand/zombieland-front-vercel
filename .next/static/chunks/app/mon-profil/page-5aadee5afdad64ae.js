(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[644],{4742:(e,t,r)=>{Promise.resolve().then(r.bind(r,6565))},4831:(e,t,r)=>{"use strict";r.d(t,{W:()=>c,x:()=>i});var n=r(5155),o=r(7383),a=r(2115),s=r(9509);let l=(0,a.createContext)({token:null,setToken:()=>{},user:null,loading:!0}),i=e=>{let{children:t}=e,[r,i]=(0,a.useState)(()=>o.A.get("zombieland_token")||null),[c,u]=(0,a.useState)(null),[d,m]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{(async()=>{if(!r){u(null),m(!1);return}try{let e=await fetch("".concat(s.env.NEXT_PUBLIC_API_URL,"/auth/verify"),{headers:{Authorization:"Bearer ".concat(r)},credentials:"include"});if(e.ok){let t=await e.json();u(t.user)}else o.A.remove("zombieland_token"),i(null),u(null)}catch(e){console.error("Erreur lors du check token :",e),o.A.remove("zombieland_token"),i(null),u(null)}finally{m(!1)}})()},[r]),(0,n.jsx)(l.Provider,{value:{token:r,setToken:e=>{e?(o.A.set("zombieland_token",e,{expires:1,secure:!0,sameSite:"strict"}),i(e)):(o.A.remove("zombieland_token"),i(null),u(null))},user:c,loading:d},children:t})},c=()=>(0,a.useContext)(l)},5695:(e,t,r)=>{"use strict";var n=r(8999);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},6565:(e,t,r)=>{"use strict";r.d(t,{default:()=>i});var n=r(5155),o=r(4831),a=r(5695),s=r(2115),l=r(9509);function i(){let{token:e,user:t}=(0,o.W)(),[r,i]=(0,s.useState)(!0),[c,u]=(0,s.useState)(!1),[d,m]=(0,s.useState)(""),p=(0,a.useRouter)(),f=(0,a.useSearchParams)(),[x,h]=(0,s.useState)(""),[b,g]=(0,s.useState)(""),[v,y]=(0,s.useState)(""),[N,j]=(0,s.useState)(""),[k,C]=(0,s.useState)({}),[w,E]=(0,s.useState)(""),S=async e=>{e.preventDefault(),C({}),E("");let r=N.replace(/\D/g,"");if(!/^0[1-9]\d{8}$/.test(r))return void E("Num\xe9ro de t\xe9l\xe9phone invalide.");try{let e=await fetch("".concat(l.env.NEXT_PUBLIC_API_URL,"/myProfil/").concat(null==t?void 0:t.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstname:x,lastname:b,email:v,phone:N.replace(/\D/g,"")}),credentials:"include"}),r=await e.json();if(!e.ok){if(400===e.status&&Array.isArray(r.errors)){let e=Object.fromEntries(r.errors.map(e=>[e.path[0],e.message]));C(e);return}if(409===e.status&&"string"==typeof r.error)return void(r.error.toLowerCase().includes("email")?C({email:r.error}):r.error.toLowerCase().includes("t\xe9l\xe9phone")?C({phone:r.error}):E(r.error));E(r.error||"Erreur lors de la modification des donn\xe9es du profil.");return}e.ok&&m("Modifications effectu\xe9es avec succ\xe8s")}catch(e){e instanceof Error?(console.error(e),E("Identifiants invalides ou erreur serveur.")):(console.error("Unknown error",e),E("Erreur inconnue."))}};return((0,s.useEffect)(()=>{if(!e||!t||!t.id){u(!0);let e=setTimeout(()=>{let e=f.get("redirect")||"/mon-profil";p.push("/connexion?redirect=".concat(e))},3e3);return()=>clearTimeout(e)}},[e,t,p,f]),(0,s.useEffect)(()=>{let r=async()=>{try{let r=await fetch("".concat(l.env.NEXT_PUBLIC_API_URL,"/myProfil/").concat(null==t?void 0:t.id),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},credentials:"include"});if(!r.ok)return void console.error("Erreur lors de la r\xe9cup\xe9ration des informations du profil");let n=await r.json();h(n.firstname||""),g(n.lastname||""),y(n.email||""),j(n.phone||"")}catch(e){console.error("Erreur lors de la r\xe9cup\xe9ration des informations du profil",e)}finally{i(!1)}};e&&t&&t.id?r():(i(!1),u(!1))},[e,t]),c)?(0,n.jsxs)("p",{className:"text-center text-primary mt-6",children:["Vous devez \xeatre connect\xe9 pour avoir acc\xe8s \xe0 votre profil,",(0,n.jsx)("br",{}),"vous allez \xeatre redirig\xe9 vers la page de connexion..."]}):r?(0,n.jsx)("p",{className:"text-center text-primary mt-6",children:"Chargement des informations du profil..."}):(0,n.jsxs)("form",{onSubmit:S,className:"flex flex-col gap-4 w-full max-w-xl mx-auto bg-surface bg-opacity-90 backdrop-blur-sm p-6 rounded-lg border border-primary shadow-lg",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsx)("label",{htmlFor:"firstName",className:"text-primary-light font-subtitle uppercase tracking-wide text-xl",children:"Pr\xe9nom"}),(0,n.jsx)("input",{id:"firstName",name:"firstName",type:"text",value:x,onChange:e=>h(e.target.value),className:"bg-bg text-text border rounded-lg px-3 py-2 focus:outline-none font-body text xl\n			\n						focus:border-primary placeholder:text-muted"}),k.firstname&&(0,n.jsx)("p",{className:"text-red-500 text-sm font-body",children:k.firstname})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsx)("label",{htmlFor:"lastName",className:"text-primary-light font-subtitle uppercase tracking-wide text-xl",children:"Nom"}),(0,n.jsx)("input",{id:"lastName",name:"lastName",type:"text",value:b,onChange:e=>g(e.target.value),className:"bg-bg text-text border rounded-lg px-3 py-2 focus:outline-none font-body text xl\n						\n						focus:border-primary placeholder:text-muted"}),k.lastname&&(0,n.jsx)("p",{className:"text-red-500 text-sm font-body",children:k.lastname})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsx)("label",{htmlFor:"email",className:"text-primary-light font-subtitle uppercase tracking-wide text-xl",children:"Email"}),(0,n.jsx)("input",{id:"email",name:"email",type:"email",value:v,onChange:e=>y(e.target.value),className:"bg-bg text-text border rounded-lg px-3 py-2 focus:outline-none font-body text xl\n						\n						focus:border-primary placeholder:text-muted"}),k.email&&(0,n.jsx)("p",{className:"text-red-500 text-sm font-body",children:k.email})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsx)("label",{htmlFor:"phone",className:"text-primary-light font-subtitle uppercase tracking-wide text-xl",children:"T\xe9l\xe9phone"}),(0,n.jsx)("input",{id:"phone",name:"phone",type:"tel",value:N,onChange:e=>j(e.target.value.replace(/\D/g,"").slice(0,10).replace(/(\d{2})(?=\d)/g,"$1 ").trim()),className:"bg-bg text-text border rounded-lg px-3 py-2 focus:outline-none font-body text xl\n						\n						focus:border-primary placeholder:text-muted"}),k.phone&&(0,n.jsx)("p",{className:"text-red-500 text-sm font-body",children:k.phone})]}),w&&(0,n.jsx)("p",{className:"text-red-500 text-sm font-body",children:w}),d&&(0,n.jsx)("p",{className:"text-primary text-md text-center prose prose-invert font-body",children:d}),(0,n.jsx)("button",{type:"submit",className:"bg-primary text-black font-subtitle uppercase tracking-wide py-2 rounded-lg hover:bg-primary-dark transition flex items-center justify-center gap-2",children:"Modifier"})]})}},7383:(e,t,r)=>{"use strict";function n(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}r.d(t,{A:()=>o});var o=function e(t,r){function o(e,o,a){if("undefined"!=typeof document){"number"==typeof(a=n({},r,a)).expires&&(a.expires=new Date(Date.now()+864e5*a.expires)),a.expires&&(a.expires=a.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var l in a)a[l]&&(s+="; "+l,!0!==a[l]&&(s+="="+a[l].split(";")[0]));return document.cookie=e+"="+t.write(o,e)+s}}return Object.create({set:o,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],n={},o=0;o<r.length;o++){var a=r[o].split("="),s=a.slice(1).join("=");try{var l=decodeURIComponent(a[0]);if(n[l]=t.read(s,l),e===l)break}catch(e){}}return e?n[e]:n}},remove:function(e,t){o(e,"",n({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,n({},this.attributes,t))},withConverter:function(t){return e(n({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}},e=>{e.O(0,[441,964,358],()=>e(e.s=4742)),_N_E=e.O()}]);