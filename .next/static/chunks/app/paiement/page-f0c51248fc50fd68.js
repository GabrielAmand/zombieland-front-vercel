(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[198],{569:(e,t,r)=>{Promise.resolve().then(r.bind(r,2710))},2383:(e,t,r)=>{"use strict";r.d(t,{e:()=>o});var n=r(9509);function o(){if(!n.env.NEXT_PUBLIC_API_URL)throw Error("NEXT_PUBLIC_API_URL n'est pas d\xe9finie.");return n.env.NEXT_PUBLIC_API_URL}},2710:(e,t,r)=>{"use strict";r.d(t,{default:()=>u});var n=r(5155),o=r(5695),s=r(2115),a=r(4831),i=r(2383);function c(){return(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-background p-8 rounded shadow-lg text-center text-text",children:[(0,n.jsx)("h3",{className:"text-2xl font-bold mb-4 text-primary",children:"Paiement valid\xe9 !"}),(0,n.jsx)("p",{children:"Vous allez \xeatre redirig\xe9 vers votre page de r\xe9servations..."})]})})}function u(){let{token:e,loading:t}=(0,a.W)(),r=(0,o.useRouter)(),[u,l]=(0,s.useState)(!1),[d,m]=(0,s.useState)(!1),[p,f]=(0,s.useState)(null),[h,v]=(0,s.useState)(null);(0,s.useEffect)(()=>{t||e||r.push("/connexion?redirect=/paiement")},[e,t,r]),(0,s.useEffect)(()=>{let e=localStorage.getItem("zombieland_reservation");e?v(JSON.parse(e)):r.push("/reservations")},[r]);let x=async()=>{if(h&&e){m(!0),f(null);try{let t=await fetch("".concat((0,i.e)(),"/reservations"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},credentials:"include",body:JSON.stringify({visit_date:h.date,nb_participants:h.visitors})});if(!t.ok)throw Error("Erreur API: ".concat(t.status));l(!0),localStorage.removeItem("zombieland_reservation"),setTimeout(()=>{r.push("/mes-reservations")},5e3)}catch(e){console.error(e),f("Le paiement a \xe9chou\xe9. Veuillez r\xe9essayer.")}finally{m(!1)}}};return h?(0,n.jsxs)("div",{className:"bg-background p-6 rounded shadow-lg text-text text-center border border-primary",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold text-primary-light mb-4",children:"Confirmation de votre r\xe9servation"}),(0,n.jsxs)("p",{children:["Date : ",h.date]}),(0,n.jsxs)("p",{children:["Nombre de visiteurs : ",h.visitors]}),(0,n.jsxs)("p",{children:["Prix total : ",h.calculatedPrice," â‚¬"]}),p&&(0,n.jsx)("p",{className:"text-red-500 mt-2",children:p}),(0,n.jsx)("button",{type:"button",onClick:x,disabled:d,className:"mt-6 mx-auto flex items-center justify-center rounded-lg font-bold transition\n    ".concat(d?"bg-primary/50 cursor-not-allowed text-bg":"bg-primary text-bg hover:bg-primary-dark","\n    px-3 py-1.5 text-sm sm:px-5 sm:py-2 sm:text-base"),children:t?"Paiement en cours...":"Valider le paiement"}),u&&(0,n.jsx)(c,{})]}):(0,n.jsx)("p",{className:"text-center text-text",children:"Aucune r\xe9servation trouv\xe9e, vous allez \xeatre redirig\xe9 vers la page de r\xe9servation."})}},4831:(e,t,r)=>{"use strict";r.d(t,{W:()=>u,x:()=>c});var n=r(5155),o=r(7383),s=r(2115),a=r(9509);let i=(0,s.createContext)({token:null,setToken:()=>{},user:null,loading:!0}),c=e=>{let{children:t}=e,[r,c]=(0,s.useState)(()=>o.A.get("zombieland_token")||null),[u,l]=(0,s.useState)(null),[d,m]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{(async()=>{if(!r){l(null),m(!1);return}try{let e=await fetch("".concat(a.env.NEXT_PUBLIC_API_URL,"/auth/verify"),{headers:{Authorization:"Bearer ".concat(r)},credentials:"include"});if(e.ok){let t=await e.json();l(t.user)}else o.A.remove("zombieland_token"),c(null),l(null)}catch(e){console.error("Erreur lors du check token :",e),o.A.remove("zombieland_token"),c(null),l(null)}finally{m(!1)}})()},[r]),(0,n.jsx)(i.Provider,{value:{token:r,setToken:e=>{e?(o.A.set("zombieland_token",e,{expires:1,secure:!0,sameSite:"strict"}),c(e)):(o.A.remove("zombieland_token"),c(null),l(null))},user:u,loading:d},children:t})},u=()=>(0,s.useContext)(i)},5695:(e,t,r)=>{"use strict";var n=r(8999);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},7383:(e,t,r)=>{"use strict";function n(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}r.d(t,{A:()=>o});var o=function e(t,r){function o(e,o,s){if("undefined"!=typeof document){"number"==typeof(s=n({},r,s)).expires&&(s.expires=new Date(Date.now()+864e5*s.expires)),s.expires&&(s.expires=s.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var i in s)s[i]&&(a+="; "+i,!0!==s[i]&&(a+="="+s[i].split(";")[0]));return document.cookie=e+"="+t.write(o,e)+a}}return Object.create({set:o,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],n={},o=0;o<r.length;o++){var s=r[o].split("="),a=s.slice(1).join("=");try{var i=decodeURIComponent(s[0]);if(n[i]=t.read(a,i),e===i)break}catch(e){}}return e?n[e]:n}},remove:function(e,t){o(e,"",n({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,n({},this.attributes,t))},withConverter:function(t){return e(n({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}},e=>{e.O(0,[441,964,358],()=>e(e.s=569)),_N_E=e.O()}]);